import { useEffect, useState } from "react";
import moment from 'moment';
// Components
import Logo from "./components/Logo";
// Services
import moviesAPI from "./services/movies";

const App = () => {
  const [categories, setCategories] = useState([
    { name: "popular", label: "Popular", movies: [] },
    { name: "now_playing", label: "Now Playing", movies: [] },
    { name: "upcoming", label: "Upcoming", movies: [] },
    { name: "top_rated", label: "Top Rated", movies: [] },
    // { name: "", label: "Favorites", movies: [] },
    // { name: "", label: "Saved", movies: [] },
  ]);

  useEffect(() => {
    fetchMovies();
  }, []);

  const fetchMovies = async () => {
    const updatedCategories = await Promise.all(
      categories.map(async (category) => {
        try {
          const res = await moviesAPI.getMoviesByCategory(category.name);
          return { ...category, movies: res.data.results };
        } catch (error) {
          console.error(error);
          return category;
        }
      })
    );
    setCategories(updatedCategories);
  };

  return (
    <div className="bg-[#343434] w-screen h-screen overflow-auto">
      {/* Nav */}
      <div className="bg-black w-full h-16 text-[#F6F6F6] flex justify-between px-8">
        <div className="flex items-center">
          {/* logo */}
          <Logo />
          {/* Categories */}
          {categories.map((category, index) => (
            <div className="font-semibold p-5" key={index}>
              {category.label}
            </div>
          ))}
        </div>

        <div className="flex gap-5 items-center">
          <div>
            <svg
              width="26"
              height="25"
              viewBox="0 0 26 25"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12.1866 4.03674V1.72858C12.1866 1.52453 12.2676 1.32883 12.4119 1.18455C12.5562 1.04026 12.7519 0.959198 12.956 0.959198C13.16 0.959198 13.3557 1.04026 13.5 1.18455C13.6443 1.32883 13.7253 1.52453 13.7253 1.72858V4.03674C13.7253 4.2408 13.6443 4.43649 13.5 4.58078C13.3557 4.72507 13.16 4.80613 12.956 4.80613C12.7519 4.80613 12.5562 4.72507 12.4119 4.58078C12.2676 4.43649 12.1866 4.2408 12.1866 4.03674ZM19.111 12.5C19.111 13.7174 18.7501 14.9074 18.0737 15.9196C17.3974 16.9318 16.4361 17.7207 15.3114 18.1866C14.1867 18.6524 12.9491 18.7743 11.7552 18.5368C10.5612 18.2993 9.46446 17.7131 8.60365 16.8523C7.74285 15.9915 7.15663 14.8948 6.91913 13.7008C6.68164 12.5068 6.80353 11.2692 7.26939 10.1445C7.73526 9.01985 8.52417 8.05855 9.53637 7.38222C10.5486 6.70589 11.7386 6.3449 12.956 6.3449C14.5878 6.34668 16.1524 6.99574 17.3063 8.14966C18.4602 9.30357 19.1093 10.8681 19.111 12.5ZM17.5723 12.5C17.5723 11.587 17.3015 10.6945 16.7943 9.9353C16.287 9.17616 15.5661 8.58447 14.7225 8.23507C13.879 7.88567 12.9508 7.79426 12.0554 7.97238C11.1599 8.1505 10.3373 8.59016 9.69173 9.23576C9.04612 9.88137 8.60646 10.7039 8.42834 11.5994C8.25022 12.4949 8.34164 13.4231 8.69104 14.2666C9.04043 15.1101 9.63212 15.8311 10.3913 16.3383C11.1504 16.8456 12.0429 17.1163 12.956 17.1163C14.1799 17.115 15.3533 16.6283 16.2188 15.7628C17.0842 14.8974 17.571 13.7239 17.5723 12.5ZM6.25653 6.88924C6.40089 7.03361 6.5967 7.11472 6.80087 7.11472C7.00503 7.11472 7.20084 7.03361 7.34521 6.88924C7.48958 6.74488 7.57068 6.54907 7.57068 6.3449C7.57068 6.14074 7.48958 5.94493 7.34521 5.80056L5.80643 4.26179C5.66207 4.11742 5.46626 4.03632 5.26209 4.03632C5.05793 4.03632 4.86212 4.11742 4.71775 4.26179C4.57338 4.40616 4.49228 4.60196 4.49228 4.80613C4.49228 5.0103 4.57338 5.2061 4.71775 5.35047L6.25653 6.88924ZM6.25653 18.1107L4.71775 19.6495C4.57338 19.7939 4.49228 19.9897 4.49228 20.1939C4.49228 20.398 4.57338 20.5938 4.71775 20.7382C4.86212 20.8826 5.05793 20.9637 5.26209 20.9637C5.46626 20.9637 5.66207 20.8826 5.80643 20.7382L7.34521 19.1994C7.41669 19.1279 7.4734 19.0431 7.51208 18.9497C7.55077 18.8563 7.57068 18.7562 7.57068 18.6551C7.57068 18.554 7.55077 18.4539 7.51208 18.3605C7.4734 18.2671 7.41669 18.1822 7.34521 18.1107C7.27372 18.0393 7.18886 17.9826 7.09546 17.9439C7.00206 17.9052 6.90196 17.8853 6.80087 17.8853C6.69977 17.8853 6.59967 17.9052 6.50627 17.9439C6.41287 17.9826 6.32801 18.0393 6.25653 18.1107ZM19.111 7.11429C19.2121 7.11437 19.3122 7.09453 19.4056 7.05592C19.499 7.01731 19.5839 6.96067 19.6554 6.88924L21.1942 5.35047C21.3385 5.2061 21.4196 5.0103 21.4196 4.80613C21.4196 4.60196 21.3385 4.40616 21.1942 4.26179C21.0498 4.11742 20.854 4.03632 20.6498 4.03632C20.4457 4.03632 20.2498 4.11742 20.1055 4.26179L18.5667 5.80056C18.459 5.90816 18.3856 6.04531 18.3559 6.19464C18.3261 6.34396 18.3414 6.49875 18.3997 6.63942C18.4579 6.78008 18.5566 6.90028 18.6833 6.98482C18.8099 7.06935 18.9588 7.11441 19.111 7.11429ZM19.6554 18.1107C19.511 17.9664 19.3152 17.8853 19.111 17.8853C18.9069 17.8853 18.7111 17.9664 18.5667 18.1107C18.4223 18.2551 18.3412 18.4509 18.3412 18.6551C18.3412 18.8593 18.4223 19.0551 18.5667 19.1994L20.1055 20.7382C20.177 20.8097 20.2618 20.8664 20.3552 20.9051C20.4486 20.9438 20.5487 20.9637 20.6498 20.9637C20.7509 20.9637 20.851 20.9438 20.9444 20.9051C21.0378 20.8664 21.1227 20.8097 21.1942 20.7382C21.2656 20.6667 21.3223 20.5819 21.361 20.4885C21.3997 20.3951 21.4196 20.295 21.4196 20.1939C21.4196 20.0928 21.3997 19.9927 21.361 19.8993C21.3223 19.8059 21.2656 19.721 21.1942 19.6495L19.6554 18.1107ZM5.26209 12.5C5.26209 12.2959 5.18103 12.1002 5.03675 11.956C4.89246 11.8117 4.69676 11.7306 4.49271 11.7306H2.18455C1.98049 11.7306 1.7848 11.8117 1.64051 11.956C1.49622 12.1002 1.41516 12.2959 1.41516 12.5C1.41516 12.704 1.49622 12.8997 1.64051 13.044C1.7848 13.1883 1.98049 13.2694 2.18455 13.2694H4.49271C4.69676 13.2694 4.89246 13.1883 5.03675 13.044C5.18103 12.8997 5.26209 12.704 5.26209 12.5ZM12.956 20.1939C12.7519 20.1939 12.5562 20.2749 12.4119 20.4192C12.2676 20.5635 12.1866 20.7592 12.1866 20.9632V23.2714C12.1866 23.4755 12.2676 23.6712 12.4119 23.8154C12.5562 23.9597 12.7519 24.0408 12.956 24.0408C13.16 24.0408 13.3557 23.9597 13.5 23.8154C13.6443 23.6712 13.7253 23.4755 13.7253 23.2714V20.9632C13.7253 20.7592 13.6443 20.5635 13.5 20.4192C13.3557 20.2749 13.16 20.1939 12.956 20.1939ZM23.7274 11.7306H21.4192C21.2152 11.7306 21.0195 11.8117 20.8752 11.956C20.7309 12.1002 20.6498 12.2959 20.6498 12.5C20.6498 12.704 20.7309 12.8997 20.8752 13.044C21.0195 13.1883 21.2152 13.2694 21.4192 13.2694H23.7274C23.9314 13.2694 24.1271 13.1883 24.2714 13.044C24.4157 12.8997 24.4968 12.704 24.4968 12.5C24.4968 12.2959 24.4157 12.1002 24.2714 11.956C24.1271 11.8117 23.9314 11.7306 23.7274 11.7306Z"
                fill="#F6F6F6"
              />
            </svg>
          </div>
          <div>
            <svg
              width="25"
              height="25"
              viewBox="0 0 25 25"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M14.0036 13.0443L10.1567 16.8913C10.0852 16.9628 10.0003 17.0195 9.90692 17.0581C9.81352 17.0968 9.71342 17.1167 9.61232 17.1167C9.51123 17.1167 9.41112 17.0968 9.31773 17.0581C9.22433 17.0195 9.13946 16.9628 9.06798 16.8913C8.9965 16.8198 8.93979 16.7349 8.90111 16.6415C8.86242 16.5481 8.84251 16.448 8.84251 16.3469C8.84251 16.2458 8.86242 16.1457 8.90111 16.0523C8.93979 15.9589 8.9965 15.8741 9.06798 15.8026L11.6021 13.2694H2.68784C2.48379 13.2694 2.28809 13.1883 2.14381 13.044C1.99952 12.8998 1.91846 12.7041 1.91846 12.5C1.91846 12.2959 1.99952 12.1003 2.14381 11.956C2.28809 11.8117 2.48379 11.7306 2.68784 11.7306H11.6021L9.06798 9.19741C8.92361 9.05304 8.84251 8.85724 8.84251 8.65307C8.84251 8.4489 8.92361 8.2531 9.06798 8.10873C9.21235 7.96436 9.40815 7.88326 9.61232 7.88326C9.81649 7.88326 10.0123 7.96436 10.1567 8.10873L14.0036 11.9557C14.0751 12.0271 14.1319 12.112 14.1706 12.2054C14.2093 12.2988 14.2292 12.3989 14.2292 12.5C14.2292 12.6011 14.2093 12.7012 14.1706 12.7946C14.1319 12.888 14.0751 12.9729 14.0036 13.0443ZM18.845 3.26736H13.4593C13.2552 3.26736 13.0595 3.34842 12.9152 3.49271C12.7709 3.637 12.6899 3.8327 12.6899 4.03675C12.6899 4.2408 12.7709 4.4365 12.9152 4.58079C13.0595 4.72508 13.2552 4.80614 13.4593 4.80614H18.845V20.1939H13.4593C13.2552 20.1939 13.0595 20.2749 12.9152 20.4192C12.7709 20.5635 12.6899 20.7592 12.6899 20.9633C12.6899 21.1673 12.7709 21.363 12.9152 21.5073C13.0595 21.6516 13.2552 21.7326 13.4593 21.7326H18.845C19.2531 21.7326 19.6445 21.5705 19.933 21.2819C20.2216 20.9934 20.3837 20.602 20.3837 20.1939V4.80614C20.3837 4.39803 20.2216 4.00664 19.933 3.71806C19.6445 3.42948 19.2531 3.26736 18.845 3.26736Z"
                fill="#F6F6F6"
              />
            </svg>
          </div>
        </div>
      </div>

      {/* slider */}
      <div className="h-96 bg-cyan-400"></div>

      {/* Movies */}
      <div className="grid grid-cols-5">
        {/* filters */}
        <div className="bg-[#262626]"></div>

        {/* Categories */}
        <div className="col-span-4 p-4 text-[#f6f6f6]">
          {categories.map((category, index) => (
            <div key={index}>
              <h1 className="font-bold text-xl pb-2 text-white">{category.label}</h1>

              <div className="flex gap-4 w-full overflow-auto">
                {category.movies.map((movie: any, idx) => (
                  <div key={idx} className="min-w-52 h-96 flex flex-col">
                    <div className="h-56">
                      <img
                        className="rounded-t-md"
                        src={`https://image.tmdb.org/t/p/w500${movie.poster_path}`}
                        alt="poster_path"
                      />
                    </div>
                    <div className="bg-[#262626] flex-1 p-2 mt-3 rounded-b-md">
                      <p className="font-semibold mb-2">{movie.title}</p>
                      <p className="text-xs mb-1">{moment(movie.release_date).format('MMMM D, YYYY')}</p>
                      <div className="grid grid-cols-3">
                        <div>
                          <p>Rating</p>
                          {Math.ceil(movie.popularity/100)}
                        </div>
                        <div>
                          <p>Favorites</p>
                          <svg
                            width="25"
                            height="25"
                            viewBox="0 0 25 25"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path
                              d="M23.4375 9.17969C23.4375 16.0156 13.3018 21.5488 12.8701 21.7773C12.7563 21.8385 12.6292 21.8706 12.5 21.8706C12.3708 21.8706 12.2436 21.8385 12.1299 21.7773C11.6982 21.5488 1.5625 16.0156 1.5625 9.17969C1.56431 7.57444 2.20279 6.03546 3.33788 4.90038C4.47296 3.76529 6.01194 3.12681 7.61719 3.125C9.63379 3.125 11.3994 3.99219 12.5 5.45801C13.6006 3.99219 15.3662 3.125 17.3828 3.125C18.9881 3.12681 20.527 3.76529 21.6621 4.90038C22.7972 6.03546 23.4357 7.57444 23.4375 9.17969Z"
                              fill="#F6F6F6"
                            />
                          </svg>
                        </div>
                        <div>
                          <p>Save</p>
                          <svg
                            width="15"
                            height="19"
                            viewBox="0 0 15 19"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path
                              d="M0.208252 18.875V2.20833C0.208252 1.63542 0.412245 1.14497 0.820231 0.736979C1.22822 0.328993 1.71867 0.125 2.29159 0.125H12.7083C13.2812 0.125 13.7716 0.328993 14.1796 0.736979C14.5876 1.14497 14.7916 1.63542 14.7916 2.20833V18.875L7.49992 15.75L0.208252 18.875Z"
                              fill="#F6F6F6"
                            />
                          </svg>
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

export default App;
